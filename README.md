go-zero-cicd

ğŸ“¦ åŸºäº go-zero çš„å¾®æœåŠ¡åº”ç”¨ CI/CD å®ç°ç¤ºä¾‹
ä½¿ç”¨ Harbor + Jenkins + GitLab + Kubernetes å®Œæ•´ä¸²è” ä»æäº¤åˆ°éƒ¨ç½² çš„è‡ªåŠ¨åŒ–æµç¨‹ã€‚

æœ¬ä»“åº“å±•ç¤ºäº†å¦‚ä½•æ­å»ºä¸€ä¸ªé’ˆå¯¹ go-zero åº”ç”¨çš„ CI/CD æµæ°´çº¿ï¼ŒåŒ…æ‹¬ï¼š

CIï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ã€ä»£ç æ£€æŸ¥ã€é•œåƒæ„å»ºä¸æ¨é€

CDï¼šè‡ªåŠ¨éƒ¨ç½²åˆ° Kubernetes

å·¥å…·é“¾ï¼šHarbor + Jenkins + GitLab + Kubernetes

â­ è¿™æ˜¯ä¸€ä¸ªå®æˆ˜å‹ DevOps æ ·ä¾‹å·¥ç¨‹ï¼Œé€‚åˆå­¦ä¹ å¦‚ä½•åœ¨ä¸­å¤§å‹åç«¯é¡¹ç›®ä¸­å®ç°è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹ã€‚

ğŸ“Œ ä¸»è¦åŠŸèƒ½

âœ” è‡ªåŠ¨æ‹‰å– GitLab æäº¤è§¦å‘æ„å»º
âœ” ä½¿ç”¨ Jenkins ä½œä¸ºæµæ°´çº¿å¼•æ“
âœ” å•å…ƒæµ‹è¯• + é™æ€æ£€æŸ¥æ‰§è¡Œ
âœ” é•œåƒæ„å»ºå¹¶æ¨é€åˆ° Harbor é•œåƒä»“åº“
âœ” è‡ªåŠ¨éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤
âœ” ç¤ºä¾‹ Go å¾®æœåŠ¡åŸºäº go-zero æ¡†æ¶

(ä»“åº“è¯´æ˜æ¥è‡ªé¡¹ç›®æè¿°å’Œç›®å½•ç»“æ„ä¿¡æ¯æ•´ç†) 
GitHub

ğŸ§± é¡¹ç›®ç»“æ„ï¼ˆç¤ºä¾‹ï¼‰
md
.
â”œâ”€â”€ .gitlab-ci.yml         # GitLab CI/CD é…ç½®ï¼ˆè§¦å‘ Jenkins æˆ–è‡ªèº«æµç¨‹ï¼‰
â”œâ”€â”€ Jenkinsfile            # Jenkins Pipeline å®šä¹‰
â”œâ”€â”€ main.go                # ç¤ºä¾‹ Go æœåŠ¡
â”œâ”€â”€ go.mod                 # Go æ¨¡å—å®šä¹‰
â”œâ”€â”€ go.sum
â”œâ”€â”€ helm/                  # Helm Chart æˆ– k8s éƒ¨ç½² manifest
â”œâ”€â”€ scripts/               # è¾…åŠ©è„šæœ¬ï¼ˆæ„å»ºã€éƒ¨ç½²ï¼‰
â””â”€â”€ README.md

ğŸš€ CI/CD æµç¨‹æ¦‚è§ˆ
ğŸ“Œ æŒç»­é›†æˆ (CI)

ä»£ç æ¨é€åˆ° GitLab

GitLab æˆ– Jenkins è§¦å‘ CI æµæ°´çº¿

è¿è¡Œ Go å•å…ƒæµ‹è¯•å’Œé™æ€ä»£ç æ£€æŸ¥ï¼ˆå¦‚ go vet/golangci-lintï¼‰

æ„å»º Docker é•œåƒ

å°†é•œåƒæ¨é€åˆ° Harbor é•œåƒä»“åº“

ğŸ“Œ æŒç»­äº¤ä»˜ (CD)

Jenkins ç›‘æµ‹é•œåƒä»“åº“

ç”Ÿæˆ Kubernetes éƒ¨ç½²èµ„æº

è‡ªåŠ¨æ›´æ–°é›†ç¾¤æœåŠ¡ï¼ˆDeployment / StatefulSetï¼‰

è‡ªåŠ¨æ»šåŠ¨å‡çº§

âš™ï¸ ç¯å¢ƒä¾èµ–åŠå‡†å¤‡

è¯·ç¡®ä¿ä»¥ä¸‹ç»„ä»¶å·²æ­å»ºï¼š

å·¥å…·	ä½œç”¨
GitLab	æºä»£ç ä»“åº“ + CI è§¦å‘
Jenkins	æµæ°´çº¿æ‰§è¡Œå¼•æ“
Harbor	é•œåƒä»“åº“ç®¡ç†
Kubernetes é›†ç¾¤	è¿è¡ŒæœåŠ¡
go-zero	å¾®æœåŠ¡æ¡†æ¶
ğŸ“ˆ ç¤ºä¾‹æµç¨‹è¯´æ˜ï¼ˆå¯æ‰©å±•ï¼‰
ğŸ§ª æœ¬åœ°æ‰§è¡Œ
# è·å–ä»£ç 
git clone git@github.com:Veyronliao/go-zero-cicd.git

# è¿è¡Œ Go æœåŠ¡
go run main.go

ğŸ“¦ ä½¿ç”¨ Jenkins

Jenkinsfile ä¸­å®šä¹‰äº†æµæ°´çº¿é˜¶æ®µï¼Œä¾‹å¦‚ï¼š

pipeline {
  stages {
    stage('Test') { ... }
    stage('Build Image') { ... }
    stage('Push to Harbor') { ... }
    stage('Deploy to K8s') { ... }
  }
}


é€šè¿‡å‚æ•°åŒ– Pipelineï¼Œå¯ä»¥çµæ´»æ”¯æŒä¸åŒç¯å¢ƒï¼ˆdev/stage/prodï¼‰éƒ¨ç½²ã€‚

ğŸ—‚ Kubernetes éƒ¨ç½²

å°†æ„å»ºå¥½çš„é•œåƒéƒ¨ç½²åˆ° Kubernetesï¼š

ç¤ºä¾‹ manifestï¼š

apiVersion: apps/v1
kind: Deployment
metadata:
  name: go-zero-app
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: app
        image: harbor.mycompany.com/go-zero-app:latest
        ports:
        - containerPort: 8080

ğŸ§  é€‚åˆå­¦ä¹ ä¸å®è·µ

è¿™ä¸ª Repo éä»…ç¤ºä¾‹ä»£ç ï¼Œè€Œæ˜¯ä¸€ä¸ª CI/CD çœŸæ­£å¯è¿è¡Œçš„è·¯å¾„ã€‚é€‚åˆï¼š

DevOps / SRE å­¦ä¹  CI/CD è‡ªåŠ¨åŒ–å®è·µ

åç«¯å·¥ç¨‹å¸ˆç†è§£ä»ä»£ç åˆ°éƒ¨ç½²çš„ç«¯åˆ°ç«¯æµç¨‹

ä¼ä¸šçº§ Go é¡¹ç›®æµæ°´çº¿æ­å»ºå‚è€ƒ

ğŸ“ å‚è€ƒèµ„æ–™

go-zero æ¡†æ¶å®˜æ–¹ç®€ä»‹ä¸ç‰¹æ€§ï¼ˆAPI ç”Ÿæˆã€å¾®æœåŠ¡æ²»ç†ç­‰ï¼‰ 
go-zero.dev

CICD åŸºæœ¬æ¦‚å¿µä¸æµç¨‹æœ€ä½³å®è·µï¼ˆGitLab/Jenkins/Harbor/K8sï¼‰

ğŸ·ï¸ è®¸å¯ä¿¡æ¯

MIT / å¼€æºåè®®ï¼ˆè§†é¡¹ç›®åŸä»“åº“è®¾å®šï¼‰
ç®€ä»‹ï¼šè¿™æ˜¯ä¸€ä¸ªä½¿ç”¨jenkins+harbor+gitlab+k8så®ç°go-zero cicdçš„ç³»åˆ—æ–‡<br

ç›®å½•ï¼š
[1ã€CI/CDç¯å¢ƒæ­å»ºä¹‹å®‰è£…gitlab](./DOC/1ã€éƒ¨ç½²CICDç¯å¢ƒ-æ­å»ºgitlab.md)<br>
[2ã€éƒ¨ç½²CICDç¯å¢ƒ-æ­å»ºharbor](./DOC/2ã€éƒ¨ç½²CICDç¯å¢ƒ-æ­å»ºharbor.md)<br>
[3ã€éƒ¨ç½²CICDç¯å¢ƒ-æ­å»ºJenkins](./DOC/3ã€éƒ¨ç½²CICDç¯å¢ƒ-æ­å»ºJenkins.md)<br>
[4ã€ä¼ ç»Ÿæ–¹å¼å‘å¸ƒgo-zeroå¾®æœåŠ¡åˆ°k8s](./DOC/4ã€ä¼ ç»Ÿæ–¹å¼å‘å¸ƒgo-zeroå¾®æœåŠ¡åˆ°k8s.md)<br>
[5ã€Jenkinså®‰è£…kubernetesæ’ä»¶](./DOC/5ã€Jenkinså®‰è£…kubernetesæ’ä»¶.md)<br>
[6ã€åˆ›å»ºSCMå®ç°æäº¤ä»£ç è§¦å‘æ„å»ºä»»åŠ¡](./DOC/6ã€åˆ›å»ºSCMå®ç°æäº¤ä»£ç è§¦å‘æ„å»ºä»»åŠ¡.md)<br>
[7ã€ä½¿ç”¨è„šæœ¬å¼è¯­æ³•ç¼–å†™pipelineæ„å»ºgo-zeroå¾®æœåŠ¡å‘å¸ƒä»»åŠ¡](./DOC/7ã€ä½¿ç”¨è„šæœ¬å¼è¯­æ³•ç¼–å†™pipelineæ„å»ºgo-zeroå¾®æœåŠ¡å‘å¸ƒä»»åŠ¡.md)<br>
[8ã€è§£å†³ä½¿ç”¨å®¿ä¸»æœºdockeræƒé™ä¸å¤Ÿçš„é—®é¢˜](./DOC/8ã€è§£å†³ä½¿ç”¨å®¿ä¸»æœºdockeræƒé™ä¸å¤Ÿçš„é—®é¢˜.md)<br>
